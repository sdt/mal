#!/usr/bin/env perl

use 5.20.1;
use warnings;

use Function::Parameters qw( :strict );
use Term::ReadLine;

use FindBin ();
use lib "$FindBin::Bin/../lib";

use MAL::Reader;

exit main(@ARGV) ? 0 : 1;

#-------------------------------------------------------------------------------

fun main(@argv) {
    my $term = Term::ReadLine->new('mal');
    my $prompt = 'user> ';
    while (defined(my $input = $term->readline($prompt))) {
        chomp($input);
        say rep($input);
        $term->addhistory($input) if $input =~ /\S/;
    }
    return 0;
}

fun rep($arg) {
    return PRINT(EVAL(READ($arg)));
}

fun READ($input) {
    my $ast = MAL::Reader->read_str($input);
    return $ast;
}

fun EVAL($arg) {
    return $arg;
}

fun PRINT($arg) {
    return $arg->to_string;
}
